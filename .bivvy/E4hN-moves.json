{
  "Climb": "E4hN",
  "moves": [
    {
      "status": "completed",
      "description": "Temporarily Remove End-to-End (E2E) Testing Infrastructure and Update ARCHITECTURE.md",
      "details": "Remove all current E2E testing files if they still exist, configurations, and related scripts/Makefile targets from the `frontend/e2e/` directory. This includes files like `frontend/e2e/**/*.test.ts`, `frontend/e2e/fixtures.ts`, and `frontend/playwright.config.ts`. The `test:e2e` script in `frontend/package.json` should be removed. The main `test` script in `frontend/package.json` should be updated to only run unit tests (`npm run test:unit -- --run`). Modify `ARCHITECTURE.md` to remove current E2E testing details from section 2 (Frontend Architecture - specifically `frontend/tests/` and `frontend/e2e/`) and add a new top-level section (e.g., Section 10) titled 'End-to-End Testing (Future)' stating that E2E tests will be reintroduced later, potentially in a root `mus/e2e/` directory, targeting the production Docker container. Ensure `make ci` passes.",
      "rules_filepaths_to_follow": "`.cursor/rules/json.mdc,.cursor/rules/typescript.mdc,.cursor/rules/makefile.mdc,.cursor/rules/md.mdc,.cursor/rules/makefile_commands.mdc`",
      "filepaths_to_modify": "`frontend/e2e/,frontend/playwright.config.ts,frontend/package.json,docker/makefiles/frontend.mk,ARCHITECTURE.md`"
    },
    {
      "status": "completed",
      "description": "Remove PostCSS Dependency, Configuration, and Documentation References",
      "details": "1. Uninstall the `postcss` package using the command `make front-npm-uninstall ARGS=\"postcss\"`. 2. Delete the `frontend/postcss.config.js` file if it exists. 3. Update documentation files `ARCHITECTURE.md` (e.g., section 2 Frontend Architecture, section 9 Key Technical Decisions if PostCSS was explicitly mentioned) and `README.md` (e.g., Tech Stack section) to remove references to PostCSS as an explicit part of the toolchain, assuming `@tailwindcss/vite` handles necessary PostCSS processing internally. 4. Update the `E4hN-climb.md` PRD file to reflect the removal of PostCSS from technical requirements and relevant file lists. 5. Verify `frontend/src/app.css` (and `frontend/tailwind.config.js` if it's a JS file) do not contain any non-standard PostCSS configurations or directives that would break after its removal (standard `@tailwind` directives are fine). 6. Execute `make ci` from the project root. Resolve any linting, formatting, testing, or build issues arising from these changes to ensure the command passes successfully. Testing: A successful `make ci` (including frontend build, lint, and unit tests) is required.",
      "rules_filepaths_to_follow": "`.cursor/rules/makefile.mdc,.cursor/rules/makefile_commands.mdc,.cursor/rules/json.mdc,.cursor/rules/javascript.mdc,.cursor/rules/css.mdc,.cursor/rules/md.mdc`",
      "filepaths_to_modify": "`frontend/package.json,frontend/package-lock.json,frontend/postcss.config.js,ARCHITECTURE.md,README.md,.bivvy/E4hN-climb.md,frontend/src/app.css,frontend/tailwind.config.js`"
    },
    {
      "status": "completed",
      "description": "Refactor Frontend Dependencies, Remove Autoprefixer, and Add Uninstall Command",
      "details": "1. Ensure the `front-npm-uninstall` make target exists in `docker/makefiles/frontend.mk` (it should execute `cd $(FRONTEND_DIR) && npm uninstall $(ARGS)`). If not, create it. 2. Use the make target to attempt removal of `@playwright/test` and `autoprefixer` from `frontend/package.json` devDependencies by executing `make front-npm-uninstall ARGS=\"@playwright/test autoprefixer\"`. This is a cleanup step; these packages might not be present. 3. Identify runtime dependencies currently in `devDependencies`: `bits-ui`, `clsx`, `mode-watcher`, `svelte-sonner`, `tailwind-merge`, `tailwind-variants`. For each of these, first uninstall them from `devDependencies` using `make front-npm-uninstall ARGS=\"<package-name>\"`. Then, install them into `dependencies` using `make front-npm-install ARGS=\"<package-name>\"`. Update `frontend/package.json` and `frontend/package-lock.json` accordingly. 4. Execute `make ci` from the project root. Resolve any linting, formatting, testing, or build issues arising from these dependency changes to ensure the command passes successfully. Testing: A successful `make ci` (including frontend build, lint, and unit tests) is required.",
      "rules_filepaths_to_follow": "`.cursor/rules/makefile.mdc,.cursor/rules/makefile_commands.mdc,.cursor/rules/json.mdc`",
      "filepaths_to_modify": "`docker/makefiles/frontend.mk,frontend/package.json,frontend/package-lock.json`"
    },
    {
      "status": "completed",
      "description": "Refactor Track Listing: Remove Pagination from Backend and Frontend",
      "details": "Modify the backend to return a simple List[TrackDTO] for all tracks, removing PagedResponseDTO. Update the frontend to consume this simplified list. Ensure all related DTOs, schemas, repository methods, API endpoints, API client functions, data loading functions, and tests are updated accordingly. PagedResponseDTO should be completely removed from the backend codebase. Frontend code in `+layout.server.ts` and related components consuming track lists must be updated. Ensure `make ci` passes. Testing: Add/update unit and integration tests for backend repository methods (`get_all`), API endpoint (`GET /api/v1/tracks`), and DTO removal. For frontend, update tests for `apiClient.ts` (`fetchTracks`) and `+layout.server.ts` (if applicable) to handle `List[TrackDTO]`.",
      "rules_filepaths_to_follow": "`.cursor/rules/python.mdc,.cursor/rules/typescript.mdc,.cursor/rules/svelte.mdc,.cursor/rules/makefile_commands.mdc`",
      "filepaths_to_modify": "`backend/src/mus/infrastructure/persistence/sqlite_track_repository.py,backend/src/mus/infrastructure/api/routers/track_router.py,backend/src/mus/application/dtos/responses.py,backend/src/mus/application/dtos/__init__.py,backend/src/mus/infrastructure/api/schemas.py,backend/tests/api/test_track_api.py,backend/tests/persistence/test_sqlite_track_repository.py,frontend/src/lib/services/apiClient.ts,frontend/src/routes/(app)/+layout.server.ts,frontend/src/routes/(app)/+layout.svelte,frontend/src/routes/(app)/+page.svelte,frontend/src/routes/(app)/__tests__/layout.server.test.ts,frontend/src/lib/services/apiClient.test.ts`"
    },
    {
      "status": "completed",
      "description": "Implement Conditional CORS Middleware in Backend",
      "details": "Modify `backend/src/mus/main.py` to enable CORS middleware only if the `APP_ENV` environment variable is NOT set to 'production'. If `APP_ENV` is 'production', the CORS middleware should be omitted. Ensure `make ci` passes. Testing: Add integration tests (e.g., in `backend/tests/test_main_cors.py`) to verify CORS headers' presence (allowing `http://localhost:5173`) or absence based on `APP_ENV` value via OPTIONS requests.",
      "rules_filepaths_to_follow": "`.cursor/rules/python.mdc,.cursor/rules/makefile_commands.mdc`",
      "filepaths_to_modify": "`backend/src/mus/main.py,backend/tests/test_main_cors.py`"
    },
    {
      "status": "todo",
      "description": "Implement Development Startup Process: DB Reset, Cover Cleaning, and Async Scan",
      "details": "Modify the `lifespan` context manager in `backend/src/mus/main.py`. If `APP_ENV` is not 'production': 1. Reset the database by dropping and recreating all tables using the existing async engine (`async with engine.begin() as conn: await conn.run_sync(SQLModel.metadata.drop_all)` then `create_all`). 2. Empty the `./data/covers` directory (e.g., using `shutil.rmtree` and `os.makedirs`). 3. Asynchronously initiate music scanning using `ScanTracksUseCase`, ensuring server startup is not blocked (e.g. using `asyncio.create_task`). Ensure `make ci` passes. Testing: Add tests (e.g., in `backend/tests/test_main_startup.py`) for this conditional startup logic, covering DB operations (mocking DDL calls), directory cleaning, and async task creation.",
      "rules_filepaths_to_follow": "`.cursor/rules/python.mdc,.cursor/rules/makefile_commands.mdc`",
      "filepaths_to_modify": "`backend/src/mus/main.py,backend/tests/test_main_startup.py`"
    },
    {
      "status": "todo",
      "description": "Configure Music Directory via MUSIC_DIR Environment Variable",
      "details": "Modify `backend/src/mus/infrastructure/scanner/file_system_scanner.py` to use the `MUSIC_DIR` environment variable (read via `os.getenv('MUSIC_DIR', './music')`). If `MUSIC_DIR` is unset, it should default to `./music`. Ensure the scanner and related directory creation logic use this configured path. Ensure `make ci` passes. Testing: Update tests for `FileSystemScanner` (e.g., in `backend/tests/infrastructure/test_file_system_scanner.py`) to verify it respects `MUSIC_DIR` and the default.",
      "rules_filepaths_to_follow": "`.cursor/rules/python.mdc,.cursor/rules/makefile_commands.mdc`",
      "filepaths_to_modify": "`backend/src/mus/infrastructure/scanner/file_system_scanner.py,backend/tests/infrastructure/test_file_system_scanner.py`"
    }
  ]
}
